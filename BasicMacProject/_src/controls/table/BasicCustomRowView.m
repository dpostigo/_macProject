//
// Created by Daniela Postigo on 5/17/13.
//
// To change the template use AppCode | Preferences | File Templates.
//


#import "BasicCustomRowView.h"
#import "NSBezierPath+Additions.h"
#import "NSBezierPath+DPUtils.h"


#define INSETX 16.0f
#define INSETY 7.0f
#define RADIUS 3.0f
#define LEFT_RECT_WIDTH 125.0f // this is the width of the grey part of the cell
#define SHADOW_BLUR_RADIUS 4.0f
#define SHADOW_OPACITY 0.4f
#define SHADOW_OFFSET_X 2.0f
#define SHADOW_OFFSET_Y -2.0f
#define LEFT_SIDE_CELL_COLOR [NSColor colorWithCalibratedWhite:0.89 alpha:1.0]
#define LEFT_SIDE_CELL_COLOR_SELECTED [NSColor colorWithCalibratedRed:0.608 green:0.784 blue:0.910 alpha:1.0]
#define RIGHT_SIDE_CELL_COLOR [NSColor colorWithCalibratedWhite:0.8 alpha:1.0]
#define CELL_BORDER_COLOR [NSColor whiteColor]


@implementation BasicCustomRowView


@synthesize selectedGradient;

@synthesize insetRect;
@synthesize pathOptions;

@synthesize selectedPathOptions;

- (id) initWithFrame: (NSRect) frameRect {
    self = [super initWithFrame: frameRect];
    if (self) {

        insetRect = NSZeroRect;

        pathOptions = [[PathOptions alloc] init];
        pathOptions.cornerRadius  = 2.0;
        pathOptions.cornerOptions = NSBezierPathUpperLeft | NSBezierPathUpperRight | NSBezierPathLowerLeft | NSBezierPathLowerRight;
        pathOptions.borderColor   = [NSColor whiteColor];
        pathOptions.borderWidth   = 1.0;
        pathOptions.gradient      = [[NSGradient alloc] initWithColorsAndLocations:
                [NSColor colorWithDeviceWhite: 0.85f alpha: 1.0f], 0.0f,
                [NSColor colorWithDeviceWhite: 0.90f alpha: 1.0f], 0.2f,
                [NSColor colorWithDeviceWhite: 0.93f alpha: 1.0f], 0.5f,
                [NSColor colorWithDeviceWhite: 0.94f alpha: 1.0f], 0.7f,
                [NSColor colorWithDeviceWhite: 0.95f alpha: 1.0f], 1.0f,
                nil];

        pathOptions.outerShadow                  = [[NSShadow alloc] init];
        pathOptions.outerShadow.shadowColor      = [NSColor blackColor];
        pathOptions.outerShadow.shadowBlurRadius = 2.0;
        pathOptions.outerShadow.shadowOffset     = NSMakeSize(0, -1);


        selectedGradient = [[NSGradient alloc] initWithColorsAndLocations:
                [NSColor colorWithDeviceWhite: 0.2 alpha: 1.0f], 0.0,
                [NSColor colorWithDeviceWhite: 0.3 alpha: 1.0f], 0.2,
                [NSColor colorWithDeviceWhite: 0.2 alpha: 1.0f], 1.0,
                nil];

    }

    return self;
}

- (void) setFrame: (NSRect) frameRect {
    [super setFrame: frameRect];
    [self setNeedsDisplay: YES];
}


- (NSRect) modifiedRect: (NSRect) rect {
    rect.origin.x += insetRect.origin.x;
    rect.origin.y += insetRect.origin.y;
    rect.size.width += insetRect.size.width;
    rect.size.height += insetRect.size.height;
    return rect;
}

- (void) drawBackgroundInRect: (NSRect) dirtyRect {
    BOOL   selected = self.isSelected;
    NSRect rect     = [self modifiedRect: self.bounds];
    [self drawBackgroundInRect: rect selected: selected];
}


- (void) drawBackgroundInRect: (NSRect) dirtyRect selected: (BOOL) selected {

    NSBezierPath *roundedPath = [NSBezierPath bezierPathWithRoundedRect: dirtyRect corners: self.cornerOptions radius: self.cornerRadius];
    [roundedPath drawShadow: self.shadow shadowOpacity: shadowOpacity];


    NSBezierPath *path = [NSBezierPath bezierPathWithRect: dirtyRect cornerRadius: self.cornerRadius options: NSBezierPathLowerLeft | NSBezierPathLowerRight | NSBezierPathUpperRight | NSBezierPathUpperLeft];

    [path drawGradient: self.selected ? selectedGradient : self.gradient angle: -90];
    [path drawStroke: self.borderColor width: self.borderWidth];
}


- (BOOL) isOpaque {
    return NO;
}


#pragma mark Getters / Setters

- (void) setCornerOptions: (NSBezierPathCornerOptions) cornerOptions1 {
    pathOptions.cornerOptions = cornerOptions1;
}

- (NSBezierPathCornerOptions) cornerOptions {
    return pathOptions.cornerOptions;
}


- (CGFloat) cornerRadius {
    return pathOptions.cornerRadius;
}

- (void) setCornerRadius: (CGFloat) cornerRadius1 {
    pathOptions.cornerRadius = cornerRadius1;
}

- (NSColor *) borderColor {
    return pathOptions.borderColor;
}

- (void) setBorderColor: (NSColor *) borderColor1 {
    pathOptions.borderColor = borderColor1;
}

- (CGFloat) borderWidth {
    return pathOptions.borderWidth;
}

- (void) setBorderWidth: (CGFloat) borderWidth1 {
    pathOptions.borderWidth = borderWidth1;
}

- (NSGradient *) gradient {
    return pathOptions.gradient;
}

- (void) setGradient: (NSGradient *) gradient1 {
    pathOptions.gradient = gradient1;
}

- (NSShadow *) innerShadow {
    return pathOptions.innerShadow;
}

- (void) setInnerShadow: (NSShadow *) innerShadow {
    pathOptions.innerShadow = innerShadow;
}

- (NSShadow *) outerShadow {
    return pathOptions.outerShadow;
}

- (void) setOuterShadow: (NSShadow *) outerShadow {
    pathOptions.outerShadow = outerShadow;
}

@end